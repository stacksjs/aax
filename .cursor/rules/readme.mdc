---
description: General information based on the latest ./README.md content
globs:
---
Update it if APIs change:

# AAX Audio Converter

A TypeScript library and CLI tool for converting Audible AAX audiobooks to standard MP3, M4A, or M4B formats.

![Screenshot](.github/art/screenshot.png)

## Features

- Convert AAX files to MP3, M4A, or M4B formats
- Preserve chapter information
- Automatically detect Audible activation code
- Split audiobooks by chapters
- Simple command-line interface

## Installation

```bash
# Install globally
npm install -g @stacksjs/aax

# Or use with npx
npx @stacksjs/aax
```

## Requirements

- `ffmpeg` & [`audible`](https://github.com/mkb79/audible-cli) must be installed and available in your PATH

_Please read [Using the Audible CLI Integration](#using-the-audible-cli-integration) for more information._

## CLI Usage

### Convert an AAX file to MP3

```bash
aax convert /path/to/audiobook.aax
```

### Convert with custom options

```bash
aax convert /path/to/audiobook.aax --format m4b --output ./my-audiobooks --bitrate 192
```

### Convert and split by chapters

```bash
aax split /path/to/audiobook.aax
```

### Available CLI Options

- `-o, --output <dir>` - Output directory (default: ./converted)
- `-f, --format <format>` - Output format: mp3, m4a, m4b (default: mp3)
- `-c, --code <code>` - Audible activation code (auto-detected if not provided)
- `--chapters` - Preserve chapter information (default: true)
- `-b, --bitrate <kbps>` - Audio bitrate in kbps (default: 'source' to match the original file)
- `-v, --verbose` - Enable verbose logging
- `--flat-folder-structure` - Use flat folder structure
- `--series-title-in-folder-structure` - Include series title in folder structure
- `--variable-bit-rate` - Apply variable bit rate
- `--aac-encoding-44-1` - Fix AAC encoding for 44.1 kHz
- `--use-named-chapters` - Use named chapters if available
- `--skip-short-chapters-duration <seconds>` - Skip short chapters between book parts
- `--skip-very-short-chapter-duration <seconds>` - Skip very short chapters at begin and end

## Library Usage

```typescript
import { convertAAX } from 'aax'

async function convertBook() {
  const result = await convertAAX({
    inputFile: '/path/to/audiobook.aax',
    outputFormat: 'mp3',
    outputDir: './converted',
    chaptersEnabled: true,
    bitrate: 128,
  })

  if (result.success) {
    console.log(`Conversion complete: ${result.outputPath}`)
  }
  else {
    console.error(`Conversion failed: ${result.error}`)
  }
}
```

## Configuration

You can create an `aax.config.ts` or `aax.config.js` file in your project root to customize default settings:

```typescript
export default {
  verbose: true,
  outputFormat: 'mp3',
  outputDir: './my-audiobooks',
  chaptersEnabled: true,
  bitrate: 192,
  // Optional: manually set the activation code
  // activationCode: '1a2b3c4d',
  // Optional: specify a custom FFmpeg path
  // ffmpegPath: '/usr/local/bin/ffmpeg',
  // New options
  flatFolderStructure: false,
  seriesTitleInFolderStructure: true,
  fullCaptionForBookFolder: false,
  partFolderPrefix: 'standard',
  sequenceNumberDigits: 2,
  customSearchWords: [],
  additionalPunctuation: '',
  intermediateFileCopy: false,
  aacEncoding44_1: false,
  variableBitRate: false,
  reduceBitRate: 'no',
  fileType: 'm4a',
  useISOLatin1: false,
  extractCoverImage: true,
  useNamedChapters: true,
  skipShortChaptersDuration: 25,
  skipVeryShortChapterDuration: 10,
  verifyChapterMarks: 'all',
  preferEmbeddedChapterTimes: true,
}
```

## Using the Audible CLI Integration

This tool integrates with the Audible CLI to automatically retrieve activation bytes (activation codes) from Audible's servers using your account credentials. This makes it much easier to convert your AAX audiobooks without manually finding activation codes.

### Prerequisites

1. Download the Audible CLI binary and place it in the root of your project:
   - [Audible CLI Releases](https://github.com/mkb79/audible-cli/releases)
   - Choose the appropriate version for your OS (e.g., `audible-cli-0.2.0-windows-amd64.exe` for Windows)
   - Rename it to `audible` and place it in the project root

### Setting up Audible CLI

Run the setup command:

```bash
aax setup-audible
```

This will:

1. Check if the audible binary exists
2. Make it executable
3. Run the quickstart wizard (you'll need to follow the interactive prompts to log in to your Audible account)
4. Retrieve your activation bytes from Audible's servers
5. Save them for future use

During the setup process, you'll see something like this:

```
Setting up Audible CLI and retrieving activation bytes...
Note: You may be prompted to log in to your Audible account.
Follow the prompts in the terminal to complete the setup.

Attempting to get activation bytes from Audible CLI...
Audible CLI is not configured. Setting up...
Starting Audible CLI quickstart. Please follow the prompts to log in to your Audible account.
# ... (interactive login process) ...

Fetching activation bytes from Audible server...
✅ Found activation bytes from Audible CLI: 2c******

✅ Successfully retrieved activation bytes: 2c******

You can now use this activation code with the convert command:
aax convert your-audiobook.aax -c 2c1eeb0a

The activation code has been saved and will be used automatically for future conversions.
```

Once set up, your activation code will be automatically used for all future conversions, so you don't need to specify it manually.

### Manual Setup (if the automated setup fails)

If the automated setup fails, you can do it manually:

1. Run: `./audible quickstart`
2. Follow the prompts to log in to your Audible account
3. Once set up, run: `./audible activation-bytes`
4. Note the activation code (a 8-character hex string like `2c1eeb0a`)
5. Use this code with the convert command:

   ```bash
   aax convert your-audiobook.aax -c YOUR_ACTIVATION_CODE
   ```
